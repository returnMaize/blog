(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{293:function(s,t,a){"use strict";a.r(t);var n=a(14),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"vite-vs-webpack"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vite-vs-webpack"}},[s._v("#")]),s._v(" Vite vs Webpack")]),s._v(" "),t("p",[t("strong",[s._v("webpack 开发环境下工作原理")])]),s._v(" "),t("p",[s._v("webpack 会通过打包入口文件找到项目中所有依赖，通过这些依赖构建出依赖图谱，然后根据依赖图谱进行代码的转化打包，将打包好的代码放到目标文件夹中，并且以该目录为服务器根路径启动一个本地服务。")]),s._v(" "),t("p",[t("strong",[s._v("vite 开发环境下工作原理")])]),s._v(" "),t("p",[s._v("直接以项目根目录为服务器根目录启动本地服务，当我们通过页面的方式请求文件时，vite 会对请求文件进行处理，将处理好的文件返回给浏览器。")]),s._v(" "),t("ul",[t("li",[s._v("第三方模块文件，通过 esbuild 预构建完成打包，并将该请求通过响应头设置为强缓存")]),s._v(" "),t("li",[s._v("单文件 vue，通过 "),t("code",[s._v("@vue/complier-sfc")]),s._v(" 将单文件 vue 转化成 js 对象返回，并将 "),t("code",[s._v("template")]),s._v(" 编译成 "),t("code",[s._v("render")]),s._v(" 函数")])]),s._v(" "),t("p",[t("strong",[s._v("相较 webpack 的优点")])]),s._v(" "),t("ul",[t("li",[s._v("第三方模块使用 esbuild 预构建，并在请求第三方模块时采用强缓存。使得第三方模块只需要打包一次，且请求一次。")])]),s._v(" "),t("h2",{attrs:{id:"初始化-vite-项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始化-vite-项目"}},[s._v("#")]),s._v(" 初始化 vite 项目")]),s._v(" "),t("p",[s._v("在搭建间，了解 "),t("code",[s._v("create-vite")]),s._v(" 和 "),t("code",[s._v("vite")]),s._v(" 的区别")]),s._v(" "),t("p",[t("strong",[s._v("create-vite")])]),s._v(" "),t("p",[s._v("提供交互式的服务，快速初始化项目。")]),s._v(" "),t("p",[t("strong",[s._v("vite")])]),s._v(" "),t("p",[s._v("用来启动开发服务器和打包项目，它是一个现代化的前端构建工具")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" create vite\n")])])]),t("p",[s._v("上述命令就是使用 "),t("code",[s._v("create-vite")]),s._v(" 初始化项目，我们可以通过它快速初始化一个 vite + vue3 的项目")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("✔ Project name: … vite-vue3-project\n✔ Select a framework: › Vue\n✔ Select a variant: › TypeScript\n\nScaffolding project "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /Users/hjx/Desktop/vite-vue3-project"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\nDone. Now run:\n\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" vite-vue3-project\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" run dev\n")])])]),t("h2",{attrs:{id:"vite-配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vite-配置文件"}},[s._v("#")]),s._v(" vite 配置文件")]),s._v(" "),t("p",[s._v("在使用 vite 启动本地服务和打包时，vite 会自动解析 "),t("code",[s._v("vite-config.[js|ts]")]),s._v(" 配置文件，并根据配置文件中的配置进行打包构建。")]),s._v(" "),t("p",[s._v("通常在企业级项目中，我们通常存在多个环境，不同的环境需要不同的配置，这时就需要多个配置文件用来区分不同环境。这时我们可以通过 "),t("code",[s._v("defineConfig")]),s._v(" 中的 "),t("code",[s._v("mode")]),s._v(" 参数实现此功能。")]),s._v(" "),t("p",[t("strong",[s._v("vite.config.ts")])]),s._v(" "),t("div",{staticClass:"language-ts extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ts"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" baseConfig "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./vite.base.config'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" devConfig "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./vite.dev.config'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" prodConfig "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./vite.prod.config'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" envResolver "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  serve"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("assign")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" baseConfig"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" devConfig"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  build"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("assign")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" baseConfig"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" prodConfig"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("defineConfig")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" mode "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// mode = serve | build")]),s._v("\n  envResolver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("h2",{attrs:{id:"vite-配置之环境变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vite-配置之环境变量"}},[s._v("#")]),s._v(" vite 配置之环境变量")]),s._v(" "),t("p",[t("strong",[s._v("内置环境变量")])]),s._v(" "),t("ul",[t("li",[t("code",[s._v("import.meta.env.MODE")]),s._v(" 项目运行环境 development ｜ production")]),s._v(" "),t("li",[t("code",[s._v("import.meta.env.BASE_URL")]),s._v(" 配置项 base 决定")]),s._v(" "),t("li",[t("code",[s._v("import.meta.env.PROD")]),s._v(" 运行环境是否是 production")]),s._v(" "),t("li",[t("code",[s._v("import.meta.env.DEV")]),s._v(" 运行环境是否是 development")]),s._v(" "),t("li",[t("code",[s._v("import.meta.env.SSR")]),s._v(" 运行环境是否运行在服务端")])]),s._v(" "),t("p",[t("strong",[s._v("环境变量文件的加载")])]),s._v(" "),t("p",[t("code",[s._v("vite")]),s._v(" 会通过 "),t("code",[s._v("dotenv")]),s._v(" 这个工具包加载项目根目录中的 .env 开头的文件中的变量（当然你也可以通过 "),t("code",[s._v("envDir")]),s._v(" 配置项指定环境变量目录）")]),s._v(" "),t("p",[s._v("不同环境下加载的环境变量文件（当然你也可以通过命令行 --mode 新增其他模式）")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v(".env          # 两种模式下都会加载\n.env.[mode]   # 指定模式下加载 mode = production | development\n")])])]),t("p",[s._v("加载的环境变量会挂载到 "),t("code",[s._v("import.meta.env")]),s._v(" 上，你可以在客户端的源码中通过它访问你定义的环境变量，当然为了防止将一些隐私性的变量暴露给客户端，vite 只会将以 VITE 开头的环境变量挂载到 "),t("code",[s._v("import.meta.env")]),s._v(" 上（你也可以通过 envPrefix 自定义前缀）。")]),s._v(" "),t("p",[t("strong",[s._v(".env")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("VITE_SOME_KEY=123\nDB_PASSWORD=foobar\n")])])]),t("p",[t("strong",[s._v("main.ts")])]),s._v(" "),t("div",{staticClass:"language-ts extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ts"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("console")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("meta"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VITE_SOME_KEY")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 123")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("console")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("meta"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DB_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// undefined")]),s._v("\n")])])]),t("h2",{attrs:{id:"vite-配置之-css"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vite-配置之-css"}},[s._v("#")]),s._v(" vite 配置之 css")]),s._v(" "),t("p",[s._v("vite 天生支持 css，当 vite 遇到文件中 css 请求时，会通过 node 中的 fs 读取该 css 的代码，并生成将该 css 插入到 body 中的 js 代码进行返回，并将 content-type 设置为 application/javascript；")]),s._v(" "),t("h3",{attrs:{id:"css-modules"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#css-modules"}},[s._v("#")]),s._v(" css.modules")]),s._v(" "),t("p",[s._v("css.modules.localsConvention 配置 css 导出类名命名规则 camelCase ｜ dashes")]),s._v(" "),t("p",[s._v("css.modules.scopeBehaviour 配置 css 作用域行为 global | local")]),s._v(" "),t("p",[s._v("css.modules.generateScopedName 配置 css 生成的类名规则")]),s._v(" "),t("p",[s._v("css.modules.hashPrefix 配置生成的 hash 的前缀")]),s._v(" "),t("p",[s._v("css.modules.globalModulePaths 不需要模块化的 css 文件路径")]),s._v(" "),t("h3",{attrs:{id:"css-preprocessoroptions"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#css-preprocessoroptions"}},[s._v("#")]),s._v(" css.preprocessorOptions")]),s._v(" "),t("p",[s._v("css.preprocessorOptions.scss 配置 sass 解析规则（参考 "),t("a",{attrs:{href:"https://sass-lang.com/documentation/js-api/interfaces/legacystringoptions/",target:"_blank",rel:"noopener noreferrer"}},[s._v("scss docs"),t("OutboundLink")],1),s._v("）")]),s._v(" "),t("p",[s._v("css.preprocessorOptions.less 配置 less 解析规则（参考 "),t("a",{attrs:{href:"https://lesscss.org/usage/#less-options",target:"_blank",rel:"noopener noreferrer"}},[s._v("less docs"),t("OutboundLink")],1),s._v("）")]),s._v(" "),t("h3",{attrs:{id:"css-postcss"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#css-postcss"}},[s._v("#")]),s._v(" css.postcss")]),s._v(" "),t("p",[s._v("vite 内置 postcss，你可以通过 "),t("code",[s._v("css.postcss")]),s._v(" 直接配置 postcss，你也可以通过 "),t("code",[s._v("postcss.config.js")]),s._v(" 进行配置。")]),s._v(" "),t("p",[s._v("如果你还不知道什么是 "),t("code",[s._v("postcss")]),s._v("，你可以把它当作一个 css 语法转化器，类似于 babel。")]),s._v(" "),t("p",[t("strong",[s._v("postcss 工作原理")])]),s._v(" "),t("p",[s._v("postcss 处理 css 时首先会将 css 转化成抽象语法树 AST，再通过 postcss 插件完成 AST 的转化操作（比如语法降级、sass 转换等），然后将转化好的 AST 转化成浏览器能够识别的 css。")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[s._v("postcss 不同于其他预处理器（如 sass、less），它凌驾于它们之上。")]),s._v(" "),t("p",[s._v("预处理器用来将如 sass、less 语法转化成 css，而 postcss 是构建一个 css 转化工作流，这条工作流中可以包含 sass、less 的处理（通过 postcss 相关插件）。")]),s._v(" "),t("p",[s._v("由于 postcss 停止了对 sass、less 转化插件的维护，现在我们通常会在 sass、less 等预处理器将代码转化成 css 之后再通过 postcss 对 css 进行降级、代码补全等 css 处理。所以 postcss 又被称为后处理器。")])]),s._v(" "),t("p",[s._v("有关 "),t("code",[s._v("postcss")]),s._v(" 的相关配置，你可以参考 "),t("a",{attrs:{href:"https://postcss.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("postcss docs"),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"css-devsourcemap"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#css-devsourcemap"}},[s._v("#")]),s._v(" css.devSourcemap")]),s._v(" "),t("p",[s._v("开启 css 源码映射，方便定位 css 代码错误位置")]),s._v(" "),t("h2",{attrs:{id:"vite-配置之-alias"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vite-配置之-alias"}},[s._v("#")]),s._v(" vite 配置之 alias")]),s._v(" "),t("p",[t("code",[s._v("resolve.alias")]),s._v(" 用来配置文件系统别名，这对于开发中导入一些层级相差很远的文件时非常有用。")]),s._v(" "),t("p",[t("strong",[s._v("vite.config.ts")])]),s._v(" "),t("div",{staticClass:"language-ts extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ts"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("defineConfig")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    resolve"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      alias"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v("'@'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolve")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__dirname"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./src'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("p",[t("strong",[s._v("src/a/b/c.ts")])]),s._v(" "),t("div",{staticClass:"language-ts extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ts"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" AComponent "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@components/A.vue'")]),s._v("\n")])])]),t("h2",{attrs:{id:"vite-插件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vite-插件"}},[s._v("#")]),s._v(" vite 插件")]),s._v(" "),t("p",[s._v("vite 中的插件就是在 vite 不同生命周期钩子时做一些事情。你可以通过阅读 "),t("a",{attrs:{href:"https://cn.vitejs.dev/guide/api-plugin.html#vite-specific-hooks",target:"_blank",rel:"noopener noreferrer"}},[s._v("vite docs"),t("OutboundLink")],1),s._v(" 了解关于 vite 生命周期钩子的内容")]),s._v(" "),t("p",[s._v("常用插件")]),s._v(" "),t("ul",[t("li",[s._v("vite-aliases")])]),s._v(" "),t("p",[s._v("原理：在 vite 中的 config 钩子执行时将配置文件中的 resolve.alias 进行修改（config 钩子会在 vite 解析配置文件前执行）")]),s._v(" "),t("ul",[t("li",[s._v("vite-plugin-html")])]),s._v(" "),t("p",[s._v("原理：使用 transformIndexHtml 钩子将转化好的 html 替换掉原来的 html，但需要使用 enforce 配置项将钩子执行时机提前")]),s._v(" "),t("ul",[t("li",[s._v("vite-plugin-mock （mockjs）")])]),s._v(" "),t("p",[s._v("原理：使用 configureServer 钩子给 vite 服务器增加中间件，劫持掉请求返回 mock 数据。")]),s._v(" "),t("p",[t("strong",[s._v("扩展")])]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://cn.vitejs.dev/guide/api-plugin.html#vite-specific-hooks",target:"_blank",rel:"noopener noreferrer"}},[s._v("vite plugin API"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://cn.vitejs.dev/plugins/",target:"_blank",rel:"noopener noreferrer"}},[s._v("vite 官方插件"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/vitejs/awesome-vite#plugins",target:"_blank",rel:"noopener noreferrer"}},[s._v("vite 社区插件"),t("OutboundLink")],1)])]),s._v(" "),t("h2",{attrs:{id:"vite-性能优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vite-性能优化"}},[s._v("#")]),s._v(" vite 性能优化")]),s._v(" "),t("ul",[t("li",[s._v("将 "),t("code",[s._v("node_modules")]),s._v(" 下的包单独打包成一个 chunk，这样有利于浏览器的缓存。")])]),s._v(" "),t("p",[t("strong",[s._v("vite.config.ts")])]),s._v(" "),t("div",{staticClass:"language-ts extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ts"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("defineConfig")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n  build"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    rollupOptions"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      output"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("manualChunks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("includes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'node_modules'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vendor'")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("ul",[t("li",[s._v("对于一些路由使用到的组件，使用动态引入 "),t("code",[s._v("import")]),s._v(" 配合 rollup 实现代码分割，完成按需加载，提高首屏加载速度。")])]),s._v(" "),t("div",{staticClass:"language-ts extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ts"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" routes "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    meta"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      title"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("component")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@/views/xxx/xxx/xxx/index.vue'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("ul",[t("li",[s._v("对于非常大的文件可以采用 gzip 压缩，小文件不要使用（浏览器解压也需要时间，小文件会适得其反）")])]),s._v(" "),t("p",[s._v("使用插件 "),t("code",[s._v("vite-plugin-compression")])]),s._v(" "),t("ul",[t("li",[s._v("对于第三方包使用 cdn 加速")])]),s._v(" "),t("p",[s._v("使用插件 "),t("code",[s._v("vite-plugin-cdn-import")])]),s._v(" "),t("p",[s._v("原理：在 transformIndexHtml 动态拥有 cdn 地址的 script 标签")]),s._v(" "),t("h2",{attrs:{id:"结尾"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#结尾"}},[s._v("#")]),s._v(" 结尾")]),s._v(" "),t("p",[s._v("本章只列出了 vite 一些常用配置，如果你想了解更多关于 vite 的内容，可以阅读 "),t("a",{attrs:{href:"https://cn.vitejs.dev/",target:"_blank",rel:"noopener noreferrer"}},[s._v("vite docs"),t("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=e.exports}}]);