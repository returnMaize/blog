<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vite vs Webpack | hx&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/blog/img/logo.png">
    <meta name="description" content="hx&#39;s blog">
    <meta name="keywords" content="blog">
    
    <link rel="preload" href="/blog/assets/css/0.styles.8b6be189.css" as="style"><link rel="preload" href="/blog/assets/js/app.8a74db86.js" as="script"><link rel="preload" href="/blog/assets/js/2.19337781.js" as="script"><link rel="preload" href="/blog/assets/js/20.149b690b.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.037764f4.js"><link rel="prefetch" href="/blog/assets/js/11.195aac6a.js"><link rel="prefetch" href="/blog/assets/js/12.99d163f3.js"><link rel="prefetch" href="/blog/assets/js/13.0ce9f1bd.js"><link rel="prefetch" href="/blog/assets/js/14.7a509b1d.js"><link rel="prefetch" href="/blog/assets/js/15.68dd0652.js"><link rel="prefetch" href="/blog/assets/js/16.609ffc09.js"><link rel="prefetch" href="/blog/assets/js/17.2fd629f4.js"><link rel="prefetch" href="/blog/assets/js/18.87a386cb.js"><link rel="prefetch" href="/blog/assets/js/19.65c2ec95.js"><link rel="prefetch" href="/blog/assets/js/21.7163487e.js"><link rel="prefetch" href="/blog/assets/js/22.680b321d.js"><link rel="prefetch" href="/blog/assets/js/23.b02bcdaf.js"><link rel="prefetch" href="/blog/assets/js/24.8b7a4934.js"><link rel="prefetch" href="/blog/assets/js/25.212e45fe.js"><link rel="prefetch" href="/blog/assets/js/26.0e563279.js"><link rel="prefetch" href="/blog/assets/js/27.6fea8ad3.js"><link rel="prefetch" href="/blog/assets/js/28.5748e7ac.js"><link rel="prefetch" href="/blog/assets/js/29.ae4dcd92.js"><link rel="prefetch" href="/blog/assets/js/3.72b2e20d.js"><link rel="prefetch" href="/blog/assets/js/30.233fb2a9.js"><link rel="prefetch" href="/blog/assets/js/31.f047d9db.js"><link rel="prefetch" href="/blog/assets/js/32.28f38411.js"><link rel="prefetch" href="/blog/assets/js/33.bbcfc091.js"><link rel="prefetch" href="/blog/assets/js/34.17f1d611.js"><link rel="prefetch" href="/blog/assets/js/35.2c6beb15.js"><link rel="prefetch" href="/blog/assets/js/36.7bb8919c.js"><link rel="prefetch" href="/blog/assets/js/37.9e1a5896.js"><link rel="prefetch" href="/blog/assets/js/38.fe1e32a6.js"><link rel="prefetch" href="/blog/assets/js/4.c3eb0cb1.js"><link rel="prefetch" href="/blog/assets/js/5.8befe194.js"><link rel="prefetch" href="/blog/assets/js/6.8837a3c6.js"><link rel="prefetch" href="/blog/assets/js/7.21b9df0d.js"><link rel="prefetch" href="/blog/assets/js/8.1f155a75.js"><link rel="prefetch" href="/blog/assets/js/9.4ace1c37.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.8b6be189.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/img/logo.png" alt="hx's blog" class="logo"> <span class="site-name can-hide">hx's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/returnMaize/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/returnMaize/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue原理篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>工程化篇</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>eslint</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/engineering/eslint.html" class="sidebar-link">eslint基础知识</a></li><li><a href="/blog/engineering/eslint-ts.html" class="sidebar-link">eslint + ts</a></li><li><a href="/blog/engineering/eslint-vue.html" class="sidebar-link">eslint + vue</a></li><li><a href="/blog/engineering/eslint-prettier.html" class="sidebar-link">eslint + prettier</a></li></ul></section></li><li><a href="/blog/engineering/prettier.html" class="sidebar-link">prettier</a></li><li><a href="/blog/engineering/commitlint.html" class="sidebar-link">commitlint</a></li><li><a href="/blog/engineering/code-standard.html" class="sidebar-link">编码规范工程化</a></li><li><a href="/blog/engineering/vite.html" aria-current="page" class="active sidebar-link">vite</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/engineering/vite.html#vite-vs-webpack" class="sidebar-link">Vite vs Webpack</a></li><li class="sidebar-sub-header"><a href="/blog/engineering/vite.html#初始化-vite-项目" class="sidebar-link">初始化 vite 项目</a></li><li class="sidebar-sub-header"><a href="/blog/engineering/vite.html#vite-配置文件" class="sidebar-link">vite 配置文件</a></li><li class="sidebar-sub-header"><a href="/blog/engineering/vite.html#vite-配置之环境变量" class="sidebar-link">vite 配置之环境变量</a></li><li class="sidebar-sub-header"><a href="/blog/engineering/vite.html#vite-配置之-css" class="sidebar-link">vite 配置之 css</a></li><li class="sidebar-sub-header"><a href="/blog/engineering/vite.html#vite-配置之-alias" class="sidebar-link">vite 配置之 alias</a></li><li class="sidebar-sub-header"><a href="/blog/engineering/vite.html#vite-插件" class="sidebar-link">vite 插件</a></li><li class="sidebar-sub-header"><a href="/blog/engineering/vite.html#vite-性能优化" class="sidebar-link">vite 性能优化</a></li><li class="sidebar-sub-header"><a href="/blog/engineering/vite.html#结尾" class="sidebar-link">结尾</a></li></ul></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能优化篇</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="vite-vs-webpack"><a href="#vite-vs-webpack" class="header-anchor">#</a> Vite vs Webpack</h2> <p><strong>webpack 开发环境下工作原理</strong></p> <p>webpack 会通过打包入口文件找到项目中所有依赖，通过这些依赖构建出依赖图谱，然后根据依赖图谱进行代码的转化打包，将打包好的代码放到目标文件夹中，并且以该目录为服务器根路径启动一个本地服务。</p> <p><strong>vite 开发环境下工作原理</strong></p> <p>直接以项目根目录为服务器根目录启动本地服务，当我们通过页面的方式请求文件时，vite 会对请求文件进行处理，将处理好的文件返回给浏览器。</p> <ul><li>第三方模块文件，通过 esbuild 预构建完成打包，并将该请求通过响应头设置为强缓存</li> <li>单文件 vue，通过 <code>@vue/complier-sfc</code> 将单文件 vue 转化成 js 对象返回，并将 <code>template</code> 编译成 <code>render</code> 函数</li></ul> <p><strong>相较 webpack 的优点</strong></p> <ul><li>第三方模块使用 esbuild 预构建，并在请求第三方模块时采用强缓存。使得第三方模块只需要打包一次，且请求一次。</li></ul> <h2 id="初始化-vite-项目"><a href="#初始化-vite-项目" class="header-anchor">#</a> 初始化 vite 项目</h2> <p>在搭建间，了解 <code>create-vite</code> 和 <code>vite</code> 的区别</p> <p><strong>create-vite</strong></p> <p>提供交互式的服务，快速初始化项目。</p> <p><strong>vite</strong></p> <p>用来启动开发服务器和打包项目，它是一个现代化的前端构建工具</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">pnpm</span> create vite
</code></pre></div><p>上述命令就是使用 <code>create-vite</code> 初始化项目，我们可以通过它快速初始化一个 vite + vue3 的项目</p> <div class="language-bash extra-class"><pre class="language-bash"><code>✔ Project name: … vite-vue3-project
✔ Select a framework: › Vue
✔ Select a variant: › TypeScript

Scaffolding project <span class="token keyword">in</span> /Users/hjx/Desktop/vite-vue3-project<span class="token punctuation">..</span>.

Done. Now run:

  <span class="token builtin class-name">cd</span> vite-vue3-project
  <span class="token function">pnpm</span> <span class="token function">install</span>
  <span class="token function">pnpm</span> run dev
</code></pre></div><h2 id="vite-配置文件"><a href="#vite-配置文件" class="header-anchor">#</a> vite 配置文件</h2> <p>在使用 vite 启动本地服务和打包时，vite 会自动解析 <code>vite-config.[js|ts]</code> 配置文件，并根据配置文件中的配置进行打包构建。</p> <p>通常在企业级项目中，我们通常存在多个环境，不同的环境需要不同的配置，这时就需要多个配置文件用来区分不同环境。这时我们可以通过 <code>defineConfig</code> 中的 <code>mode</code> 参数实现此功能。</p> <p><strong>vite.config.ts</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> baseConfig <span class="token keyword">from</span> <span class="token string">'./vite.base.config'</span>
<span class="token keyword">import</span> devConfig <span class="token keyword">from</span> <span class="token string">'./vite.dev.config'</span>
<span class="token keyword">import</span> prodConfig <span class="token keyword">from</span> <span class="token string">'./vite.prod.config'</span>

<span class="token keyword">const</span> envResolver <span class="token operator">=</span> <span class="token punctuation">{</span>
  serve<span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> baseConfig<span class="token punctuation">,</span> devConfig<span class="token punctuation">)</span><span class="token punctuation">,</span>
  build<span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> baseConfig<span class="token punctuation">,</span> prodConfig<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> mode <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// mode = serve | build</span>
  envResolver<span class="token punctuation">[</span>mode<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="vite-配置之环境变量"><a href="#vite-配置之环境变量" class="header-anchor">#</a> vite 配置之环境变量</h2> <p><strong>内置环境变量</strong></p> <ul><li><code>import.meta.env.MODE</code> 项目运行环境 development ｜ production</li> <li><code>import.meta.env.BASE_URL</code> 配置项 base 决定</li> <li><code>import.meta.env.PROD</code> 运行环境是否是 production</li> <li><code>import.meta.env.DEV</code> 运行环境是否是 development</li> <li><code>import.meta.env.SSR</code> 运行环境是否运行在服务端</li></ul> <p><strong>环境变量文件的加载</strong></p> <p><code>vite</code> 会通过 <code>dotenv</code> 这个工具包加载项目根目录中的 .env 开头的文件中的变量（当然你也可以通过 <code>envDir</code> 配置项指定环境变量目录）</p> <p>不同环境下加载的环境变量文件（当然你也可以通过命令行 --mode 新增其他模式）</p> <div class="language- extra-class"><pre class="language-text"><code>.env          # 两种模式下都会加载
.env.[mode]   # 指定模式下加载 mode = production | development
</code></pre></div><p>加载的环境变量会挂载到 <code>import.meta.env</code> 上，你可以在客户端的源码中通过它访问你定义的环境变量，当然为了防止将一些隐私性的变量暴露给客户端，vite 只会将以 VITE 开头的环境变量挂载到 <code>import.meta.env</code> 上（你也可以通过 envPrefix 自定义前缀）。</p> <p><strong>.env</strong></p> <div class="language- extra-class"><pre class="language-text"><code>VITE_SOME_KEY=123
DB_PASSWORD=foobar
</code></pre></div><p><strong>main.ts</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VITE_SOME_KEY</span><span class="token punctuation">)</span> <span class="token comment">// 123</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DB_PASSWORD</span><span class="token punctuation">)</span> <span class="token comment">// undefined</span>
</code></pre></div><h2 id="vite-配置之-css"><a href="#vite-配置之-css" class="header-anchor">#</a> vite 配置之 css</h2> <p>vite 天生支持 css，当 vite 遇到文件中 css 请求时，会通过 node 中的 fs 读取该 css 的代码，并生成将该 css 插入到 body 中的 js 代码进行返回，并将 content-type 设置为 application/javascript；</p> <h3 id="css-modules"><a href="#css-modules" class="header-anchor">#</a> css.modules</h3> <p>css.modules.localsConvention 配置 css 导出类名命名规则 camelCase ｜ dashes</p> <p>css.modules.scopeBehaviour 配置 css 作用域行为 global | local</p> <p>css.modules.generateScopedName 配置 css 生成的类名规则</p> <p>css.modules.hashPrefix 配置生成的 hash 的前缀</p> <p>css.modules.globalModulePaths 不需要模块化的 css 文件路径</p> <h3 id="css-preprocessoroptions"><a href="#css-preprocessoroptions" class="header-anchor">#</a> css.preprocessorOptions</h3> <p>css.preprocessorOptions.scss 配置 sass 解析规则（参考 <a href="https://sass-lang.com/documentation/js-api/interfaces/legacystringoptions/" target="_blank" rel="noopener noreferrer">scss docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）</p> <p>css.preprocessorOptions.less 配置 less 解析规则（参考 <a href="https://lesscss.org/usage/#less-options" target="_blank" rel="noopener noreferrer">less docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）</p> <h3 id="css-postcss"><a href="#css-postcss" class="header-anchor">#</a> css.postcss</h3> <p>vite 内置 postcss，你可以通过 <code>css.postcss</code> 直接配置 postcss，你也可以通过 <code>postcss.config.js</code> 进行配置。</p> <p>如果你还不知道什么是 <code>postcss</code>，你可以把它当作一个 css 语法转化器，类似于 babel。</p> <p><strong>postcss 工作原理</strong></p> <p>postcss 处理 css 时首先会将 css 转化成抽象语法树 AST，再通过 postcss 插件完成 AST 的转化操作（比如语法降级、sass 转换等），然后将转化好的 AST 转化成浏览器能够识别的 css。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>postcss 不同于其他预处理器（如 sass、less），它凌驾于它们之上。</p> <p>预处理器用来将如 sass、less 语法转化成 css，而 postcss 是构建一个 css 转化工作流，这条工作流中可以包含 sass、less 的处理（通过 postcss 相关插件）。</p> <p>由于 postcss 停止了对 sass、less 转化插件的维护，现在我们通常会在 sass、less 等预处理器将代码转化成 css 之后再通过 postcss 对 css 进行降级、代码补全等 css 处理。所以 postcss 又被称为后处理器。</p></div> <p>有关 <code>postcss</code> 的相关配置，你可以参考 <a href="https://postcss.org/" target="_blank" rel="noopener noreferrer">postcss docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="css-devsourcemap"><a href="#css-devsourcemap" class="header-anchor">#</a> css.devSourcemap</h3> <p>开启 css 源码映射，方便定位 css 代码错误位置</p> <h2 id="vite-配置之-alias"><a href="#vite-配置之-alias" class="header-anchor">#</a> vite 配置之 alias</h2> <p><code>resolve.alias</code> 用来配置文件系统别名，这对于开发中导入一些层级相差很远的文件时非常有用。</p> <p><strong>vite.config.ts</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
      alias<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'@'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>src/a/b/c.ts</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> AComponent <span class="token keyword">from</span> <span class="token string">'@components/A.vue'</span>
</code></pre></div><h2 id="vite-插件"><a href="#vite-插件" class="header-anchor">#</a> vite 插件</h2> <p>vite 中的插件就是在 vite 不同生命周期钩子时做一些事情。你可以通过阅读 <a href="https://cn.vitejs.dev/guide/api-plugin.html#vite-specific-hooks" target="_blank" rel="noopener noreferrer">vite docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 了解关于 vite 生命周期钩子的内容</p> <p>常用插件</p> <ul><li>vite-aliases</li></ul> <p>原理：在 vite 中的 config 钩子执行时将配置文件中的 resolve.alias 进行修改（config 钩子会在 vite 解析配置文件前执行）</p> <ul><li>vite-plugin-html</li></ul> <p>原理：使用 transformIndexHtml 钩子将转化好的 html 替换掉原来的 html，但需要使用 enforce 配置项将钩子执行时机提前</p> <ul><li>vite-plugin-mock （mockjs）</li></ul> <p>原理：使用 configureServer 钩子给 vite 服务器增加中间件，劫持掉请求返回 mock 数据。</p> <p><strong>扩展</strong></p> <ul><li><a href="https://cn.vitejs.dev/guide/api-plugin.html#vite-specific-hooks" target="_blank" rel="noopener noreferrer">vite plugin API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://cn.vitejs.dev/plugins/" target="_blank" rel="noopener noreferrer">vite 官方插件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/vitejs/awesome-vite#plugins" target="_blank" rel="noopener noreferrer">vite 社区插件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="vite-性能优化"><a href="#vite-性能优化" class="header-anchor">#</a> vite 性能优化</h2> <ul><li>将 <code>node_modules</code> 下的包单独打包成一个 chunk，这样有利于浏览器的缓存。</li></ul> <p><strong>vite.config.ts</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  build<span class="token operator">:</span> <span class="token punctuation">{</span>
    rollupOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
      output<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">manualChunks</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'node_modules'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">'vendor'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>对于一些路由使用到的组件，使用动态引入 <code>import</code> 配合 rollup 实现代码分割，完成按需加载，提高首屏加载速度。</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span>
    meta<span class="token operator">:</span> <span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/xxx/xxx/xxx/index.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><ul><li>对于非常大的文件可以采用 gzip 压缩，小文件不要使用（浏览器解压也需要时间，小文件会适得其反）</li></ul> <p>使用插件 <code>vite-plugin-compression</code></p> <ul><li>对于第三方包使用 cdn 加速</li></ul> <p>使用插件 <code>vite-plugin-cdn-import</code></p> <p>原理：在 transformIndexHtml 动态拥有 cdn 地址的 script 标签</p> <h2 id="结尾"><a href="#结尾" class="header-anchor">#</a> 结尾</h2> <p>本章只列出了 vite 一些常用配置，如果你想了解更多关于 vite 的内容，可以阅读 <a href="https://cn.vitejs.dev/" target="_blank" rel="noopener noreferrer">vite docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/engineering/code-standard.html" class="prev">
        编码规范工程化
      </a></span> <span class="next"><a href="/blog/engineering/webpack-use.html">
        webpack 使用篇
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.8a74db86.js" defer></script><script src="/blog/assets/js/2.19337781.js" defer></script><script src="/blog/assets/js/20.149b690b.js" defer></script>
  </body>
</html>
