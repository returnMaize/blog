<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>介绍 | hx&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/blog/img/logo.png">
    <meta name="description" content="hx&#39;s blog">
    <meta name="keywords" content="blog">
    
    <link rel="preload" href="/blog/assets/css/0.styles.8b6be189.css" as="style"><link rel="preload" href="/blog/assets/js/app.e6692299.js" as="script"><link rel="preload" href="/blog/assets/js/2.19337781.js" as="script"><link rel="preload" href="/blog/assets/js/9.816e0207.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.f7f8c2cf.js"><link rel="prefetch" href="/blog/assets/js/11.fdf6ac81.js"><link rel="prefetch" href="/blog/assets/js/12.71c58aee.js"><link rel="prefetch" href="/blog/assets/js/13.9fa69850.js"><link rel="prefetch" href="/blog/assets/js/14.daf4f2c0.js"><link rel="prefetch" href="/blog/assets/js/15.f77772c5.js"><link rel="prefetch" href="/blog/assets/js/16.4c757995.js"><link rel="prefetch" href="/blog/assets/js/17.ac45e363.js"><link rel="prefetch" href="/blog/assets/js/18.f72f1775.js"><link rel="prefetch" href="/blog/assets/js/19.e7938fd6.js"><link rel="prefetch" href="/blog/assets/js/20.a308067a.js"><link rel="prefetch" href="/blog/assets/js/21.b8cd9f4a.js"><link rel="prefetch" href="/blog/assets/js/3.6ebf7f92.js"><link rel="prefetch" href="/blog/assets/js/4.c3eb0cb1.js"><link rel="prefetch" href="/blog/assets/js/5.8befe194.js"><link rel="prefetch" href="/blog/assets/js/6.8837a3c6.js"><link rel="prefetch" href="/blog/assets/js/7.b342f448.js"><link rel="prefetch" href="/blog/assets/js/8.5bf72cf8.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.8b6be189.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/img/logo.png" alt="hx's blog" class="logo"> <span class="site-name can-hide">hx's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/returnMaize/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/returnMaize/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue原理篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>工程化篇</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>eslint</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/engineering/eslint.html" class="sidebar-link">eslint基础知识</a></li><li><a href="/blog/engineering/eslint-ts.html" class="sidebar-link">eslint + ts</a></li><li><a href="/blog/engineering/eslint-vue.html" class="sidebar-link">eslint + vue</a></li><li><a href="/blog/engineering/eslint-prettier.html" class="sidebar-link">eslint + prettier</a></li></ul></section></li><li><a href="/blog/engineering/prettier.html" class="sidebar-link">prettier</a></li><li><a href="/blog/engineering/commitlint.html" aria-current="page" class="active sidebar-link">commitlint</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/engineering/commitlint.html#介绍" class="sidebar-link">介绍</a></li><li class="sidebar-sub-header"><a href="/blog/engineering/commitlint.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/blog/engineering/commitlint.html#使用" class="sidebar-link">使用</a></li><li class="sidebar-sub-header"><a href="/blog/engineering/commitlint.html#测试" class="sidebar-link">测试</a></li></ul></li><li><a href="/blog/engineering/code-standard.html" class="sidebar-link">编码规范工程化</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h2> <p>之间我们了解了 <code>eslint</code> 工具，它是用来检查我们 EcmaScript 的代码是否符合规范（当然它也可以配合插件完成对其他如 Vue、TypeScript 等检查）。在此基础上，我想你应该通过名字 <code>commitlint</code> 猜到它的功能了。没错，<code>commitlint</code> 就是用来对我们代码提交时的信息进行检查。</p> <p>在没有使用 <code>commitlint</code> 工具之前，我们提交代码时的信息可能是这样的</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">'新增了xxx'</span>
<span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">'解决了xxx的缺陷'</span>
<span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">'今日阳光明媚，今日多云转晴'</span>
</code></pre></div><p>使用 <code>commitlint</code> 工具之后，我们提交代码时的信息就是这样的</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">'feat: 新增 commitlint.config.js 配置文件'</span>
<span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">'fix(route): 修复路径错误'</span>
<span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">'style(README): 文案调整'</span>
</code></pre></div><p>可以看到，使用 <code>commitlint</code> 之后。我们可以通过提交信息和清晰的了解到这次提交的变更，拿 <code>fix(route): 修复路径错误</code> 为例。<code>fix</code> 表示我们这次提交是缺陷的修复，<code>(route)</code> 表示我们这次修复的缺陷涉及到的模块在 route 中，最后 <code>修复路径错误</code> 为导致我们这次缺陷的原因。</p> <p>通过 <code>commitlint</code> 和提交规范我们可以很好的约束其他人的提交信息，便于理解他这次提交变更了那些内容。这在协同开发中是非常有用的。</p> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <h3 id="本地安装"><a href="#本地安装" class="header-anchor">#</a> 本地安装</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev @commitlint/config-conventional @commitlint/cli
</code></pre></div><h3 id="新增配置文件"><a href="#新增配置文件" class="header-anchor">#</a> 新增配置文件</h3> <p>与 <code>eslint</code> 一样，<code>commitlint</code> 同样也需要一个配置文件告诉它该以什么样的规范去检查我们的提交信息。</p> <p>commitlint.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@commitlint/config-conventional'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>通过以上配置，<code>commitlint</code> 便会以 <code>conventional commits</code> 规范进行校验，如果提交信息不符合常规的提交规范，那么此次提交将会失败。如果你想了解更多关于常规规范的内容，可以阅读 <a href="https://www.conventionalcommits.org/en/v1.0.0/" target="_blank" rel="noopener noreferrer">Conventional Commits<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h2> <p>通过前面我们可以了解到 <code>commitlint</code> 是用来检查我们提交信息是否符合规范，那它检查的时机必定是在我们提交信息 时执行。这时我们肯定第一时间想到 <code>git hooks</code>，它会在特定的时间执行。我们可以通过访问隐藏文件 <code>.git</code> 来查看到所有的 <code>git hooks</code>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> yourproject
<span class="token builtin class-name">cd</span> .git/hooks/
<span class="token function">ls</span>
<span class="token comment"># result</span>
applypatch-msg.sample           pre-push.sample
commit-msg.sample               pre-rebase.sample
fsmonitor-watchman.sample       pre-receive.sample
post-update.sample              prepare-commit-msg.sample
pre-applypatch.sample           push-to-checkout.sample
pre-commit.sample               update.sample
pre-merge-commit.sample
</code></pre></div><p>我们可以通过修改这些脚本文件使得 <code>commitlint</code> 能在信息提交时执行，但这样是愚蠢的。因为不是所有的开发者都擅长脚本编写，并且这些脚本文件在 <code>.git</code> 文件中，它属于隐藏文件。我们不可能通过此方式去完成提交信息的检查。令人庆幸的是，npm 库中存在这么一个工具 <code>husky</code>。它支持所有的 <code>git hooks</code>，通过它我们便可以在修改隐藏文件 <code>.git</code> 的情况下使用 <code>git hooks</code>。</p> <h4 id="安装-husky"><a href="#安装-husky" class="header-anchor">#</a> 安装 husky</h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> husky --save-dev
</code></pre></div><p>启用 git hooks</p> <div class="language-bash extra-class"><pre class="language-bash"><code>npx husky <span class="token function">install</span>
</code></pre></div><p>package.json 在项目安装依赖前需要启用 git hooks，这在协同开发中很重要，如果你不了解 <code>preare</code>，可以同构查看 <a href="https://docs.npmjs.com/cli/v7/using-npm/scripts" target="_blank" rel="noopener noreferrer">npm docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 进行了解</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;prepare&quot;</span><span class="token operator">:</span> <span class="token string">&quot;husky install&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>新增 <code>git hooks</code> 中的 <code>commit-msg</code> 钩子，并在这个钩子中执行 <code>commitlint</code> 进行提交信息检查</p> <div class="language-bash extra-class"><pre class="language-bash"><code>npx husky <span class="token function">add</span> .husky/commit-msg  <span class="token string">'npx --no -- commitlint --edit ${1}'</span>
</code></pre></div><p>到此我们便完成了 <code>commitlint</code> 的所有配置</p> <h2 id="测试"><a href="#测试" class="header-anchor">#</a> 测试</h2> <p>首先我们新增一个 <code>test.js</code> 文件</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">touch</span> test.js
</code></pre></div><p>将它添加到暂存区</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span>
</code></pre></div><p>最后提交到仓库，这里我们随意使用一个提交信息</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">'新增了一个 test.js 文件'</span>
</code></pre></div><p>命令行结果</p> <div class="language-bash extra-class"><pre class="language-bash"><code>⧗   input: 新增了一个 test.js 文件
✖   subject may not be empty <span class="token punctuation">[</span>subject-empty<span class="token punctuation">]</span>
✖   <span class="token builtin class-name">type</span> may not be empty <span class="token punctuation">[</span>type-empty<span class="token punctuation">]</span>

✖   found <span class="token number">2</span> problems, <span class="token number">0</span> warnings
ⓘ   Get help: https://github.com/conventional-changelog/commitlint/<span class="token comment">#what-is-commitlint</span>

husky - commit-msg hook exited with code <span class="token number">1</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span>
</code></pre></div><p>按规范提交</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">'feat(global): 新增一个 test.js 文件'</span>
</code></pre></div><p>命令行结果</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>master 557f558<span class="token punctuation">]</span> feat<span class="token punctuation">(</span>global<span class="token punctuation">)</span>: 新增一个 test.js 文件
 <span class="token number">1</span> <span class="token function">file</span> changed, <span class="token number">0</span> insertions<span class="token punctuation">(</span>+<span class="token punctuation">)</span>, <span class="token number">0</span> deletions<span class="token punctuation">(</span>-<span class="token punctuation">)</span>
 create mode <span class="token number">100644</span> test.js
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/engineering/prettier.html" class="prev">
        prettier
      </a></span> <span class="next"><a href="/blog/engineering/code-standard.html">
        编码规范工程化
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.e6692299.js" defer></script><script src="/blog/assets/js/2.19337781.js" defer></script><script src="/blog/assets/js/9.816e0207.js" defer></script>
  </body>
</html>
